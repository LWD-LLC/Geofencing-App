(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[405],{8581:function(t,e,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/",function(){return n(287)}])},287:function(t,e,n){"use strict";n.r(e),n.d(e,{default:function(){return yt}});var r=n(5893),o=n(7294),i=n(9669),c=n.n(i),u=n(6606),a=n.n(u),s=n(9008),l=function(t){return(0,r.jsxs)(o.Fragment,{children:[(0,r.jsxs)(s.default,{children:[(0,r.jsx)("meta",{charSet:"utf-8"}),(0,r.jsx)("meta",{name:"viewport",content:"width=device-width, initial-scale=1, shrink-to-fit=no"}),(0,r.jsx)("link",{rel:"stylesheet",href:"https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css",integrity:"sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm",crossOrigin:"anonymous"}),(0,r.jsx)("title",{children:t.pageTitle||"Realtime Geofencing"})]}),t.children]})},f=function(t){var e,n=t.people,o=void 0===n?[]:n,i=t.count,c=void 0===i?3:i,u=t.onSelected,a=void 0===u?function(t){return t}:u,s={fontSize:"0.8rem",height:40,borderRadius:20,cursor:"pointer"},l=function(t){return function(e){return a(t)}};return(0,r.jsxs)("div",{className:"w-100 h-100 px-3 pb-5 d-flex flex-wrap align-items-center align-content-center justify-content-center",children:[(0,r.jsx)("span",{className:"h3 text-dark text-center py-3 w-100 font-weight-bold",children:"Choose your Persona"}),(e=c,function(t){var n=[],o=0;for(e=Math.max(0,Math.min(e,t.length));o<e;){var i=Math.floor(Math.random()*t.length);n.includes(i)||++o&&n.push(i)}return n.map((function(e){var n=t[e],o=n.id,i=n.name;return(0,r.jsx)("span",{className:"d-flex align-items-center text-center text-white bg-secondary font-weight-bold py-2 px-4 mx-1 my-2",style:s,title:i,onClick:l(o),children:i},e)}))})(o)]})},p=n(3458);function h(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function d(t){return(d=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function y(t,e){return!e||"object"!==v(e)&&"function"!==typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function b(t,e){return(b=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var v=function(t){return t&&"undefined"!==typeof Symbol&&t.constructor===Symbol?"symbol":typeof t};function m(t){var e=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=d(t);if(e){var o=d(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return y(this,n)}}var g=function(t){!function(t,e){if("function"!==typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&b(t,e)}(u,t);var e,n,i,c=m(u);function u(t){var e;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,u);var n=(e=c.call(this,t)).props,r=n.person,o=r.id,i=void 0===o?null:o,a=r.position,s=void 0===a?null:a,l=n.channel,f=void 0===l?null:l;return e.id=i,e.channel=f,e.state={position:s},e}return e=u,(n=[{key:"componentDidMount",value:function(){var t=this;this.channel&&this.channel.bind("transit",(function(e){var n=e.person,r=void 0===n?{}:n,o=r.id,i=r.position;o===t.id&&t.setState({position:i})}))}},{key:"render",value:function(){var t=this.props.radius,e=this.state.position,n=new google.maps.Size(50,70);return(0,r.jsxs)(o.Fragment,{children:[(0,r.jsx)(p.Jx,{position:e,title:"You",options:{icon:{url:"https://i.imgur.com/Rhv5xQh.png",scaledSize:n}}}),(0,r.jsx)(p.Cd,{center:e,radius:t,options:{fillOpacity:.1,strokeWidth:1,strokeOpacity:.2}})]})}}])&&h(e.prototype,n),i&&h(e,i),u}(o.Component);function w(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function j(t){return(j=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function O(t,e){return!e||"object"!==_(e)&&"function"!==typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function x(t,e){return(x=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var _=function(t){return t&&"undefined"!==typeof Symbol&&t.constructor===Symbol?"symbol":typeof t};function P(t){var e=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=j(t);if(e){var o=j(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return O(this,n)}}var R=function(t){!function(t,e){if("function"!==typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&x(t,e)}(c,t);var e,n,o,i=P(c);function c(t){var e;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,c);var n=(e=i.call(this,t)).props,r=n.user,o=r.id,u=r.position,a=n.person,s=a.id,l=void 0===s?null:s,f=a.position,p=void 0===f?null:f,h=n.channel,d=void 0===h?null:h;return e.id=l,e.userID=o,e.channel=d,e.state={position:p,userPosition:u},e}return e=c,(n=[{key:"componentDidMount",value:function(){var t=this;this.channel&&this.channel.bind("transit",(function(e){var n=e.person,r=void 0===n?{}:n,o=r.id,i=r.position;o===t.id&&t.setState({position:i}),o===t.userID&&t.setState({userPosition:i})}))}},{key:"render",value:function(){var t=this.state,e=t.position,n=t.userPosition,o=this.props,i=o.person.name,c=o.radius,u=o.withinRegion,a=!!(void 0===u?function(t){return t}:u)(e)(n,c),s=new google.maps.Size(25,35),l=a?"https://i.imgur.com/9v6uW8U.png":"https://i.imgur.com/8dOrls4.png?2";return(0,r.jsx)(p.Jx,{position:e,title:i,options:{icon:{url:l,scaledSize:s}}})}}])&&w(e.prototype,n),o&&w(e,o),c}(o.Component);function S(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function k(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function E(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function N(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function C(t){return(C=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function T(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{},r=Object.keys(n);"function"===typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable})))),r.forEach((function(e){N(t,e,n[e])}))}return t}function B(t,e){return!e||"object"!==F(e)&&"function"!==typeof e?S(t):e}function M(t,e){return(M=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var F=function(t){return t&&"undefined"!==typeof Symbol&&t.constructor===Symbol?"symbol":typeof t};function z(t){var e=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=C(t);if(e){var o=C(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return B(this,n)}}var D=function(t){!function(t,e){if("function"!==typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&M(t,e)}(a,t);var e,n,i,u=z(a);function a(){var t;return k(this,a),N(S(t=u.apply(this,arguments)),"withinRegion",(function(t,e){var n=new google.maps.LatLng(t.lat,t.lng),r=google.maps.geometry.spherical.computeDistanceBetween;return function(t){var o=new google.maps.LatLng(t.lat,t.lng);return r(o,n)<=e}})),N(S(t),"analyzeRegion",(function(e,n){return function(r){var o=t.props.onRegionFiltered,i=void 0===o?function(t){return t}:o,c=t.withinRegion(e,n);i(r.map((function(t){var e=(t||{}).position;return T({},t,{within:c(e)})})))}})),t}return e=a,(n=[{key:"componentDidMount",value:function(){var t=this,e=this.props,n=e.person,r=n.id,o=n.position,i=e.radius,u=e.people,a=void 0===u?[]:u,s=e.channel,l=void 0===s?null:s,f=this.map.context.__SECRET_MAP_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,p=f.setCenter.bind(f),h=o.lat,d=o.lng;l&&l.bind("transit",(function(e){var n=e.person,c=void 0===n?{}:n,u=e.people,a=c.id,s=c.position,l=r===a,f=l?s:o;l&&p(f),t.analyzeRegion(f,i)(u)})),this.positionUpdate=setInterval((function(){h+=.001*Math.random(),d+=.001*Math.random(),c().post("/transit/".concat(r),{lat:h,lng:d})}),1e4),this.analyzeRegion(o,i)(a)}},{key:"componentWillUnmount",value:function(){clearInterval(this.positionUpdate)}},{key:"render",value:function(){var t=this,e=this.props,n=e.person,i=n.id,c=n.position,u=e.radius,a=e.people,s=e.channel;return(0,r.jsx)(p.b6,{ref:function(e){return t.map=e},zoom:15,center:c,children:(0,r.jsx)(o.Fragment,{children:a.map((function(e,n){var o=t,c={key:n,radius:u,person:e,channel:s};return e.id===i?(0,r.jsx)(g,T({},c)):(0,r.jsx)(R,T({user:t.props.person,withinRegion:function(t){return function(e,n){return o.withinRegion(e,n)(t)}}},c))}))})})}}])&&E(e.prototype,n),i&&E(e,i),a}(o.Component),I=(0,p.WS)((0,p.OI)(D));function U(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function W(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function L(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function A(t){return(A=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function X(t,e){return!e||"object"!==J(e)&&"function"!==typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function G(t,e){return(G=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var J=function(t){return t&&"undefined"!==typeof Symbol&&t.constructor===Symbol?"symbol":typeof t};function Y(t){var e=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=A(t);if(e){var o=A(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return X(this,n)}}var Q="https://maps.googleapis.com/maps/api/js?key=".concat("AIzaSyCK-mUtdz3uG2-I2u09EUNm3lbIuDM_Hag","&v=3.exp&libraries=geometry"),q=function(t){!function(t,e){if("function"!==typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&G(t,e)}(c,t);var e,n,o,i=Y(c);function c(){return U(this,c),i.apply(this,arguments)}return e=c,(n=[{key:"render",value:function(){var t={height:"100%",width:"100%",position:"relative"};return(0,r.jsx)(I,function(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{},r=Object.keys(n);"function"===typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable})))),r.forEach((function(e){L(t,e,n[e])}))}return t}({googleMapURL:Q,loadingElement:(0,r.jsx)("div",{style:t}),containerElement:(0,r.jsx)("div",{style:t}),mapElement:(0,r.jsx)("div",{style:t})},this.props))}}])&&W(e.prototype,n),o&&W(e,o),c}(o.Component);function H(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function K(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function V(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function Z(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function $(t){return($=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function tt(t,e){return!e||"object"!==nt(e)&&"function"!==typeof e?H(t):e}function et(t,e){return(et=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var nt=function(t){return t&&"undefined"!==typeof Symbol&&t.constructor===Symbol?"symbol":typeof t};function rt(t){var e=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=$(t);if(e){var o=$(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return tt(this,n)}}var ot=function(t){!function(t,e){if("function"!==typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&et(t,e)}(u,t);var e,n,i,c=rt(u);function u(){var t;return K(this,u),Z(H(t=c.apply(this,arguments)),"state",{people:[]}),Z(H(t),"updatePeople",(function(e){return t.setState({people:e})})),t}return e=u,(n=[{key:"render",value:function(){var t=this.state.people,e=this.props.person,n=e.name,i=e.id,c=function(e,n){return(0,r.jsx)(o.Fragment,{children:t.filter(e).map((function(t,e){return t.id===i?null:(0,r.jsxs)("div",{className:"d-flex border-bottom border-gray w-100 px-4 py-3 font-weight-bold text-secondary align-items-center",children:[(0,r.jsx)("div",{className:"pl-2",style:{width:30,height:30},children:(0,r.jsx)("img",{src:n,className:"img-fluid",alt:"marker"})}),(0,r.jsx)("span",{className:"pl-3",children:t.name})]},e)}))})};return i&&(0,r.jsxs)(o.Fragment,{children:[(0,r.jsxs)("div",{className:"border-bottom border-gray w-100 px-2 d-flex align-items-center bg-white justify-content-between",style:{height:90},children:[(0,r.jsx)("span",{className:"h4 text-dark mb-0 mx-4 font-weight-bold",children:"Nearby Friends"}),(0,r.jsx)("span",{className:"d-flex align-items-center text-center text-white bg-primary font-weight-bold py-2 px-4 mx-4",style:{fontSize:"0.8rem",height:40,borderRadius:20,cursor:"pointer"},title:n,children:n})]}),(0,r.jsxs)("div",{className:"w-100 d-flex flex-wrap align-items-start align-content-start position-relative",style:{height:"calc(100% - 90px)",overflowY:"auto"},children:[c((function(t){return t.within}),"https://i.imgur.com/9v6uW8U.png"),c((function(t){return!t.within}),"https://i.imgur.com/8dOrls4.png?2")]})]})}}])&&V(e.prototype,n),i&&V(e,i),u}(o.Component);function it(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function ct(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function ut(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function at(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function st(t){return(st=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function lt(t,e){return!e||"object"!==pt(e)&&"function"!==typeof e?it(t):e}function ft(t,e){return(ft=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var pt=function(t){return t&&"undefined"!==typeof Symbol&&t.constructor===Symbol?"symbol":typeof t};function ht(t){var e=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=st(t);if(e){var o=st(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return lt(this,n)}}var dt=function(t){!function(t,e){if("function"!==typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&ft(t,e)}(u,t);var e,n,o,i=ht(u);function u(){var t;return ct(this,u),at(it(t=i.apply(this,arguments)),"state",{id:null,people:[]}),at(it(t),"endConnection",(function(){t.pusher.disconnect(),c().post("/offline/".concat(t.state.id))})),at(it(t),"personaSelected",(function(e){t.setState({id:e}),c().post("/online/".concat(e))})),at(it(t),"regionFiltered",(function(e){return t.nearby.updatePeople(e)})),t}return e=u,(n=[{key:"componentWillMount",value:function(){this.pusher=new(a())("1322910",{cluster:"us2",encrypted:!0}),this.channel=this.pusher.subscribe("map-geofencing")}},{key:"componentDidMount",value:function(){var t=this;c().get("/people").then((function(e){var n=e.data.people,r=void 0===n?[]:n;t.setState({people:r})})),window.onbeforeunload=this.endConnection}},{key:"componentWillUnmount",value:function(){this.endConnection()}},{key:"render",value:function(){var t=this,e=this.state,n=e.id,o=e.people,i=o.find((function(t){return t.id===n}))||{},c=o.filter((function(t){return!t.online}));return(0,r.jsx)(l,{pageTitle:"Realtime Geofencing",children:(0,r.jsx)("main",{className:"container-fluid position-absolute h-100 bg-light",children:n?(0,r.jsxs)("div",{className:"row position-absolute w-100 h-100",children:[(0,r.jsx)("section",{className:"col-md-9 px-0 border-right border-gray position-relative h-100",children:(0,r.jsx)(q,{person:i,radius:1e3,people:o,channel:this.channel,onRegionFiltered:this.regionFiltered})}),(0,r.jsx)("section",{className:"col-md-3 position-relative d-flex flex-wrap h-100 align-items-start align-content-between bg-white px-0",children:(0,r.jsx)(ot,{ref:function(e){return t.nearby=e},person:i})})]}):(0,r.jsx)(f,{count:5,people:c,onSelected:this.personaSelected})})})}}])&&ut(e.prototype,n),o&&ut(e,o),u}(o.Component);function yt(){return(0,r.jsx)(dt,{})}}},function(t){t.O(0,[774,798,888,179],(function(){return e=8581,t(t.s=e);var e}));var e=t.O();_N_E=e}]);